services:
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    security_opt:
      - apparmor:unconfined

  adapter:
    build:
      context: ./backend/adapter
    container_name: adapter
    ports:
      - "8000:8000"
    env_file:
      - .env.adapter
    security_opt:
      - apparmor:unconfined
    depends_on:
      neo4j:
        condition: service_healthy
      redis:
        condition: service_started

  worker:
    build:
      context: .
      dockerfile: worker/Dockerfile
    container_name: worker
    env_file:
      - .env.worker
    security_opt:
      - apparmor:unconfined
    depends_on:
      - redis
      - adapter

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    container_name: frontend
    ports:
      - "3000:8080"
    env_file:
      - ./frontend/.env
    security_opt:
      - apparmor:unconfined
    depends_on:
      - adapter

volumes:
  neo4j_data:
  redis_data:
